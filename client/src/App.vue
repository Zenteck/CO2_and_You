<template lang="html">
<div id="app">
  <h1>CO<sub>2</sub> and You!</h1>
  <carbon-form />
  <carbon-score />
  <carbon-comparison  />
  <carbon-history :footprints="footprints"/>
</div>

</template>

<script>
import CarbonForm from './components/CarbonForm';
import CarbonScore from './components/CarbonScore';
import CarbonComparison from './components/CarbonComparison';
import CarbonHistory from './components/CarbonHistory';
import { eventBus } from './services/CarbonService';

export default {
  name: 'app',
  data () {
    return {
      footprints: []
    }
  },

  components: {
    'carbon-form': CarbonForm,
    'carbon-score': CarbonScore,
    'carbon-comparison': CarbonComparison,
    'carbon-history': CarbonHistory
  },
  mounted() {
    this.fetchData();

    eventBus.$on('footprint-added', footprint => this.footprints.push(footprint));

    eventBus.$on('footprint-deleted', id => {
      const index = this.footprints.findIndex(footprint => footprint._id === id);
      this.footprints.splice(index,1);
    })
  },
  methods: {
    fetchData() {
      CarbonService.getFootprints()
      .then(footprints => this.footprints = footprints);
    }
  }

}
</script>

<style lang="css" scoped>
</style>
